<!-- inv.html -->
<!-- Displays list of items currently in cabinet -->
<!-- For debugging: user can also add items manually -->
<!--

TODO:
- support writing items in recipes that aren't in the fridge (yet)
- mark presence of item somewhere with a checkmark

 -->

{% extends "dashboard.html" %}


{% block head %}
  <title>{{ device.name }} - Food Tracker</title>
{% endblock %}


{% block script %}
    {% load static %}
    <!-- Question: shouldn't this be handled in base.html???? -->

    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
    <script src="{% static 'ajax_inv.js' %}" type="text/javascript"></script>
    <script type="text/javascript">
        var myUserName = "{{ request.user.email }}"
        var addItemURL = "{% url 'add_item' id=device.id ajax=1%}"
        var deleteItemURL = function (id) {
            return "{% url 'del_item' 0 %}".replace("0", id)
        }

        // Call getList() as soon as page is finished loading to display the list
        window.onload=getList('{{ device.id }}')

        // ... also call getList every 30 seconds hereafter to update the list
        window.setInterval(getList, 5000, '{{ device.id }}');
    </script>
{% endblock %}


{% block content %}
    <h1>{{ device.name }}</h1>
    {% if message %}
    <h2> {{ message }} </h2>
    <!-- elif request.session.message -->
    <!-- <h2> request.session.message </h2> -->
    {% endif %}


    <ul>
        {% for unknown_item in unknown_items %}
            <li> <a class="btn btn-sm btn-outline-secondary" type="button" href="{% url 'id_unknown_item' unknown_item.id %}"> Identify <img src= "{{ unknown_item.image.url }}" /> </a>
            </li>
        {% endfor %}
    </ul>

    <div>
        <label>Manually add/remove Items:</label>
        <input type="text" id="item-box" autofocus>
        <!-- <input type="submit"> -->
        <script type="text/javascript">
            // www.w3schools.com/howto/howto_js_trigger_button_enter.asp
            // Get the input field
            var input = document.getElementById("item-box");

            // Execute a function when the user releases a key on the keyboard
            input.addEventListener("keyup", function(event) {
              // Number 13 is the "Enter" key on the keyboard
              if (event.keyCode === 13) {
                // Cancel the default action, if needed
                event.preventDefault();
                // Trigger the button element with a click
                document.getElementById("add-button").click();
              }
            });
        </script>
        <button id="add-button" onclick="addItem('{{ device.id }}')">
            Add item</button>
        <span id="error" class="error"></span>
        {% csrf_token %}
    </div>
    <!-- To be populated by .js -->
    <div id="inv-list"></div>
{% endblock %}
